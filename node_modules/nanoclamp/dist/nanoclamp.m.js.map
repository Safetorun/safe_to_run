{"version":3,"file":"nanoclamp.m.js","sources":["../src/index.js"],"sourcesContent":["import { createElement, Component } from 'react'\nimport PropTypes from 'prop-types'\n\nclass NanoClamp extends Component {\n  constructor (props) {\n    super(props)\n\n    this.state = {\n      noClamp: false,\n      text: '.'\n    }\n\n    this.element = null\n    this.original = props.text\n    this.lineHeight = 0\n    this.start = 0\n    this.middle = 0\n    this.end = 0\n    this.debounced = this.debounce(this.action)\n  }\n\n  componentDidMount () {\n    window.addEventListener('resize', this.debounced)\n    if (this.props.text) {\n      this.lineHeight = this.element.clientHeight + 1\n      this.clampLines()\n    }\n  }\n\n  componentWillUnmount () {\n    window.removeEventListener('resize', this.debounced)\n  }\n\n  debounce (func) {\n    let timeout\n    const later = () => {\n      timeout = null\n      func.apply(this)\n    }\n\n    return () => {\n      const callNow = !timeout\n      clearTimeout(timeout)\n      timeout = setTimeout(later, this.props.debounce)\n      if (callNow) func.apply(this)\n    }\n  }\n\n  action () {\n    if (this.original) {\n      this.setState({ noClamp: false }, this.clampLines)\n    }\n  }\n\n  clampLines () {\n    const { ellipsis, lines } = this.props\n    const maxHeight = this.lineHeight * lines + 1\n    const ellipsisLength = ellipsis === NanoClamp.defaultProps.ellipsis ? 5 : ellipsis.length * 1.2\n\n    this.start = 0\n    this.middle = 0\n    this.end = this.original.length\n\n    while (this.start <= this.end) {\n      this.middle = Math.floor((this.start + this.end) / 2)\n      this.element.innerText = this.original.slice(0, this.middle)\n\n      if (this.middle === this.original.length) {\n        this.setState({ text: this.original, noClamp: true })\n        return\n      }\n\n      this.moveMarkers(maxHeight)\n    }\n    const text = this.original.slice(0, Math.max(this.middle - ellipsisLength, 0)).trim() + ellipsis\n\n    this.setState({ text }, () => {\n      this.element.innerText = this.state.text\n    })\n  }\n\n  moveMarkers (maxHeight) {\n    if (this.element.clientHeight <= maxHeight) this.start = this.middle + 1\n    else this.end = this.middle - 1\n  }\n\n  render () {\n    const { text } = this.state\n    const { accessibility, is, text: propText, lines, debounce, ellipsis, ...props } = this.props\n    const clampProps = {\n      ref: node => (this.element = node),\n      ...(accessibility ? { title: propText } : {}),\n      ...props\n    }\n    return propText ? createElement(is, clampProps, text) : null\n  }\n}\n\nNanoClamp.defaultProps = {\n  accessibility: true,\n  is: 'div',\n  lines: 3,\n  ellipsis: 'â€¦',\n  debounce: 300\n}\n\nNanoClamp.propTypes = {\n  accessibility: PropTypes.bool,\n  is: PropTypes.string,\n  lines: PropTypes.number,\n  debounce: PropTypes.number,\n  text: PropTypes.string.isRequired,\n  ellipsis: PropTypes.string\n}\n\nexport default NanoClamp\n"],"names":["NanoClamp","Component","props","state","noClamp","text","element","original","lineHeight","start","middle","end","debounced","_this","debounce","action","window","addEventListener","this","clientHeight","clampLines","removeEventListener","func","timeout","later","apply","_this2","callNow","clearTimeout","setTimeout","setState","ellipsis","lines","maxHeight","ellipsisLength","defaultProps","length","Math","floor","innerText","slice","moveMarkers","max","trim","_this3","accessibility","is","propText","clampProps","ref","node","_this4","title","createElement"],"mappings":"2kEAGMA,oPAAkBC,+BACTC,oIACLA,IAEDC,MAAQ,CACXC,SAAS,EACTC,KAAM,OAGHC,QAAU,OACVC,SAAWL,EAAMG,OACjBG,WAAa,IACbC,MAAQ,IACRC,OAAS,IACTC,IAAM,IACNC,UAAYC,EAAKC,SAASD,EAAKE,mEAIpCC,OAAOC,iBAAiB,SAAUC,KAAKN,WACnCM,KAAKhB,MAAMG,YACRG,WAAaU,KAAKZ,QAAQa,aAAe,OACzCC,6DAKPJ,OAAOK,oBAAoB,SAAUH,KAAKN,4CAGlCU,OACJC,SACEC,EAAQ,WACZD,EAAU,KACVD,EAAKG,MAAMC,WAGN,eACCC,GAAWJ,EACjBK,aAAaL,GACbA,EAAUM,WAAWL,EAAOE,EAAKxB,MAAMY,UACnCa,GAASL,EAAKG,MAAMC,qCAKtBR,KAAKX,eACFuB,SAAS,CAAE1B,SAAS,GAASc,KAAKE,8DAKbF,KAAKhB,MAAzB6B,IAAAA,SAAUC,IAAAA,MACZC,EAAYf,KAAKV,WAAawB,EAAQ,EACtCE,EAAiBH,IAAa/B,EAAUmC,aAAaJ,SAAW,EAAsB,IAAlBA,EAASK,gBAE9E3B,MAAQ,OACRC,OAAS,OACTC,IAAMO,KAAKX,SAAS6B,OAElBlB,KAAKT,OAASS,KAAKP,KAAK,SACxBD,OAAS2B,KAAKC,OAAOpB,KAAKT,MAAQS,KAAKP,KAAO,QAC9CL,QAAQiC,UAAYrB,KAAKX,SAASiC,MAAM,EAAGtB,KAAKR,QAEjDQ,KAAKR,SAAWQ,KAAKX,SAAS6B,wBAC3BN,SAAS,CAAEzB,KAAMa,KAAKX,SAAUH,SAAS,SAI3CqC,YAAYR,OAEb5B,EAAOa,KAAKX,SAASiC,MAAM,EAAGH,KAAKK,IAAIxB,KAAKR,OAASwB,EAAgB,IAAIS,OAASZ,OAEnFD,SAAS,CAAEzB,KAAAA,IAAQ,WACtBuC,EAAKtC,QAAQiC,UAAYK,EAAKzC,MAAME,4CAI3B4B,GACPf,KAAKZ,QAAQa,cAAgBc,EAAWf,KAAKT,MAAQS,KAAKR,OAAS,EAClEQ,KAAKP,IAAMO,KAAKR,OAAS,8CAItBL,EAASa,KAAKf,MAAdE,OAC2Ea,KAAKhB,MAAhF2C,IAAAA,cAAeC,IAAAA,GAAUC,IAAN1C,KAA8CH,KAA9B8B,QAAOlB,WAAUiB,2EACtDiB,OACJC,IAAK,SAAAC,UAASC,EAAK7C,QAAU4C,IACzBL,EAAgB,CAAEO,MAAOL,GAAa,IACvC7C,UAEE6C,EAAWM,EAAcP,EAAIE,EAAY3C,GAAQ,0CAI5DL,EAAUmC,aAAe,CACvBU,eAAe,EACfC,GAAI,MACJd,MAAO,EACPD,SAAU,IACVjB,SAAU"}