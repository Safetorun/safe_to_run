"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8238],{3905:function(e,n,t){t.d(n,{Zo:function(){return c},kt:function(){return m}});var o=t(7294);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function a(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?a(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):a(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,o,r=function(e,n){if(null==e)return{};var t,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)t=a[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var u=o.createContext({}),s=function(e){var n=o.useContext(u),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},c=function(e){var n=s(e.components);return o.createElement(u.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,r=e.mdxType,a=e.originalType,u=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=s(t),m=r,f=p["".concat(u,".").concat(m)]||p[m]||d[m]||a;return t?o.createElement(f,i(i({ref:n},c),{},{components:t})):o.createElement(f,i({ref:n},c))}));function m(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var a=t.length,i=new Array(a);i[0]=p;var l={};for(var u in n)hasOwnProperty.call(n,u)&&(l[u]=n[u]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var s=2;s<a;s++)i[s]=t[s];return o.createElement.apply(null,i)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},7744:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return l},contentTitle:function(){return u},metadata:function(){return s},assets:function(){return c},toc:function(){return d},default:function(){return m}});var o=t(7462),r=t(3366),a=(t(7294),t(3905)),i=["components"],l={slug:"emulator-detection",title:"Emulator detection",author:"Daniel Llewellyn",author_url:"https://github.com/dllewellyn",description:"Use safe to run to detect emulators on Android",image:"img/emulator.png",tags:["security","android","safetorun","emulator detection","kotlin"]},u=void 0,s={permalink:"/safe_to_run/blog/emulator-detection",source:"@site/blog/2021-06-23-emulator-detection.md",title:"Emulator detection",description:"Use safe to run to detect emulators on Android",date:"2021-06-23T00:00:00.000Z",formattedDate:"June 23, 2021",tags:[{label:"security",permalink:"/safe_to_run/blog/tags/security"},{label:"android",permalink:"/safe_to_run/blog/tags/android"},{label:"safetorun",permalink:"/safe_to_run/blog/tags/safetorun"},{label:"emulator detection",permalink:"/safe_to_run/blog/tags/emulator-detection"},{label:"kotlin",permalink:"/safe_to_run/blog/tags/kotlin"}],readingTime:2.54,truncated:!1,authors:[{name:"Daniel Llewellyn",url:"https://github.com/dllewellyn"}],prevItem:{title:"Secure against de/recompiling android apps",permalink:"/safe_to_run/blog/inline-functions"},nextItem:{title:"Secure android apps with Safe to run",permalink:"/safe_to_run/blog/safe-to-run"}},c={authorsImageUrls:[void 0]},d=[{value:"Emulator detection with safe to run",id:"emulator-detection-with-safe-to-run",children:[{value:"What?",id:"what",children:[],level:3},{value:"Why?",id:"why",children:[],level:3},{value:"How?",id:"how",children:[],level:3},{value:"Conclusion",id:"conclusion",children:[],level:3}],level:2}],p={toc:d};function m(e){var n=e.components,t=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"emulator-detection-with-safe-to-run"},"Emulator detection with safe to run"),(0,a.kt)("h3",{id:"what"},"What?"),(0,a.kt)("p",null,"Emulator detection is the ability to tell when your application is running on an emulator rather than a real device, but why would you want to do this?"),(0,a.kt)("h3",{id:"why"},"Why?"),(0,a.kt)("p",null,"Reverse engineers, pentesters and hackers tend to like running your app on an emulator can be make it far easier reveal what your application is doing. A somewhat convoluted example is looking at an application\u2019s files in their private directory. For example:"),(0,a.kt)("p",null,"In that case, we can see that by preventing our app running on an emulated device, it can make it more difficult for a penetration tester to observe our application."),(0,a.kt)("h3",{id:"how"},"How?"),(0,a.kt)("p",null,"We\u2019re going to use the library Safe to run for both the detection and to help identify the emulator."),(0,a.kt)("p",null,"Core Safe to run (android library) The purpose of this configuration is to provide a simple and extensible framework"),(0,a.kt)("p",null,"Safe to run has a utility to show device information:"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},'Log.v("Device information", deviceInformation().toString())')),(0,a.kt)("p",null,"If we run this into application on the Android emulator, it looks like this:"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"DeviceInformation(osCheck=OsCheck(osVersion=30, manufacturer=Google, model=sdk_gphone_x86, board=goldfish_x86, bootloader=unknown, cpuAbi=[x86, armeabi-v7a, armeabi], host=abfarm-us-west1-c-0089, hardware=ranchu, device=generic_x86_arm), installOrigin=InstallOrigin(installOriginPackageName=), signatureVerification=SignatureInformation(signature=))")),(0,a.kt)("p",null,"And just to double check with another emulator we get this result"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"DeviceInformation(osCheck=OsCheck(osVersion=30, manufacturer=Google, model=sdk_gphone_x86_arm, board=goldfish_x86, bootloader=unknown, cpuAbi=[x86, armeabi-v7a, armeabi], host=abfarm-us-west1-c-0007, hardware=ranchu, device=generic_x86_arm), installOrigin=InstallOrigin(installOriginPackageName=), signatureVerification=SignatureInformation(signature=))")),(0,a.kt)("p",null,"There\u2019s da few things we could pick out here, but in particular we can probably start to build up this as an emulator check. We\u2019ll write up a configuration for safe to run:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'SafeToRun.init(\n    configure {\n        osDetectionCheck(\n            conditionalBuilder {\n                with(bannedBootloader("unknown"))\n                and(bannedDevice("generic_x86_arm"))\n                and(bannedBoard("goldfish_x86"))\n            }\n        ).error()\n    }\n)\nLog.v("SafeToRunResult", SafeToRun.isSafeToRun().toString())\n')),(0,a.kt)("p",null,"This check will result in the following failure"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"MultipleReports(reports=[MultipleReports(reports=[SafeToRunReportFailure(failureReason=os-config-failure, failureMessage=Banned bootloader unknown == unknown)])])"),"\nGenymotion\nAnother popular emulator is GenyMotion. If we go to the cloud GenyMotion, we can test our experiments on devices there. After connecting and installing out devices, we can have a look again at the deviceInformation() output\nGenymotion Cloud SaaS\nEdit description\ncloud.geny.io"),(0,a.kt)("p",null,"`DeviceInformation(osCheck=OsCheck(osVersion=28, manufacturer=Genymotion, model=Huawei P30 Pro, board=unknown, bootloader=unknown, cpuAbi=","[x86]",", host=68d6ec695a7c, hardware=vbox86, device=vbox86p), installOrigin=InstallOrigin(installOriginPackageName=), signatureVerification=SignatureInformation(signature=))"),(0,a.kt)("p",null,"Easy peasy, we can create a new rule for Genymotion:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},'osDetectionCheck(conditionalBuilder {\n    with(bannedBoard("unknown"))\n    and(notManufacturer("Genymotion"))\n    and(bannedBootloader("unknown"))\n}).error()\n')),(0,a.kt)("p",null,"Bluestacks\nAnother popular emulator is bluestacks. After installing and running it, we get this:"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"DeviceInformation(osCheck=OsCheck(osVersion=25, manufacturer=samsung, model=SM-G955F, board=universal8895, bootloader=unknown, cpuAbi=[x86_64, x86, arm64-v8a, armeabi-v7a, armeabi], host=Build2, hardware=samsungexynos8895, device=dream2lte), installOrigin=InstallOrigin(installOriginPackageName=), signatureVerification=SignatureInformation(signature=))")),(0,a.kt)("p",null,"This is actually a tricky one for now because the rest of the description is very similar to a real device that we wouldn\u2019t want to block. We can safely use this rule for bluestacks though:"),(0,a.kt)("p",null,(0,a.kt)("inlineCode",{parentName:"p"},"with(bannedBootloader(OsCheckConstants.UNKNOWN))")),(0,a.kt)("p",null,"Making it easier\nFrom 1.0.2 onwards, Safe to run provides two utility functions for these two emulators (more coming soon)"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-kotlin"},"SafeToRun.init {\n    osDetectionCheck(banAvdEmulator()).error()\n    osDetectionCheck(banGenymotionEmulator()).error()\n    osDetectionCheck(banBluestacksEmulator()).error()\n}\n")),(0,a.kt)("h3",{id:"conclusion"},"Conclusion"),(0,a.kt)("p",null,"Hopefully that gives us an idea of how we can perform emulator detection on Android, Safe to run provides a number of ways of checking for device information so you can tweak parameters for emulator detection \u2014 naturally there are a plenty of emulators we\u2019e not discussed here that you might want to write a check for.\nEnjoy"))}m.isMDXComponent=!0}}]);